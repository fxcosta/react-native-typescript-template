{"version":3,"sources":["error-guard.js"],"names":["_inGuard","_globalHandler","onError","e","isFatal","ErrorUtils","setGlobalHandler","fun","getGlobalHandler","reportError","error","reportFatalError","applyWithGuard","context","args","unused_onError","unused_name","apply","applyWithGuardIfNeeded","inGuard","guard","name","console","warn","guardName","guarded","global"],"mappings":"AAWA,IAAIA,QAAQ,GAAG,CAAf;;AAUA,IAAIC,cAA4B,GAAG,SAASC,OAAT,CACjCC,CADiC,EAEjCC,OAFiC,EAGjC;AACA,QAAMD,CAAN;AACD,CALD;;AAeA,IAAME,UAAU,GAAG;AACjBC,EAAAA,gBADiB,4BACAC,GADA,EACyB;AACxCN,IAAAA,cAAc,GAAGM,GAAjB;AACD,GAHgB;AAIjBC,EAAAA,gBAJiB,8BAIgB;AAC/B,WAAOP,cAAP;AACD,GANgB;AAOjBQ,EAAAA,WAPiB,uBAOLC,KAPK,EAOe;AAC9BT,IAAAA,cAAc,IAAIA,cAAc,CAACS,KAAD,EAAQ,KAAR,CAAhC;AACD,GATgB;AAUjBC,EAAAA,gBAViB,4BAUAD,KAVA,EAUoB;AAEnCT,IAAAA,cAAc,IAAIA,cAAc,CAACS,KAAD,EAAQ,IAAR,CAAhC;AACD,GAbgB;AAcjBE,EAAAA,cAdiB,0BAefL,GAfe,EAgBfM,OAhBe,EAiBfC,IAjBe,EAmBfC,cAnBe,EAqBfC,WArBe,EAsBR;AACP,QAAI;AACFhB,MAAAA,QAAQ;AAER,aAAOO,GAAG,CAACU,KAAJ,CAAUJ,OAAV,EAAmBC,IAAnB,CAAP;AACD,KAJD,CAIE,OAAOX,CAAP,EAAU;AACVE,MAAAA,UAAU,CAACI,WAAX,CAAuBN,CAAvB;AACD,KAND,SAMU;AACRH,MAAAA,QAAQ;AACT;;AACD,WAAO,IAAP;AACD,GAjCgB;AAkCjBkB,EAAAA,sBAlCiB,kCAmCfX,GAnCe,EAoCfM,OApCe,EAqCfC,IArCe,EAsCR;AACP,QAAIT,UAAU,CAACc,OAAX,EAAJ,EAA0B;AAExB,aAAOZ,GAAG,CAACU,KAAJ,CAAUJ,OAAV,EAAmBC,IAAnB,CAAP;AACD,KAHD,MAGO;AACLT,MAAAA,UAAU,CAACO,cAAX,CAA0BL,GAA1B,EAA+BM,OAA/B,EAAwCC,IAAxC;AACD;;AACD,WAAO,IAAP;AACD,GA9CgB;AA+CjBK,EAAAA,OA/CiB,qBA+CE;AACjB,WAAO,CAAC,CAACnB,QAAT;AACD,GAjDgB;AAkDjBoB,EAAAA,KAlDiB,iBAmDfb,GAnDe,EAoDfc,IApDe,EAqDfR,OArDe,EAsDO;AAAA;;AAGtB,QAAI,OAAON,GAAP,KAAe,UAAnB,EAA+B;AAC7Be,MAAAA,OAAO,CAACC,IAAR,CAAa,qDAAb,EAAoEhB,GAApE;AACA,aAAO,IAAP;AACD;;AACD,QAAMiB,SAAS,WAAGH,IAAH,WAAGA,IAAH,GAAWd,GAAG,CAACc,IAAf,mBAAuB,mBAAtC;;AACA,aAASI,OAAT,GAAwC;AAAA,wCAApBX,IAAoB;AAApBA,QAAAA,IAAoB;AAAA;;AACtC,aAAOT,UAAU,CAACO,cAAX,CACLL,GADK,EAELM,OAFK,WAELA,OAFK,GAEM,IAFN,EAGLC,IAHK,EAIL,IAJK,EAKLU,SALK,CAAP;AAOD;;AAED,WAAOC,OAAP;AACD;AAzEgB,CAAnB;AA4EAC,MAAM,CAACrB,UAAP,GAAoBA,UAApB","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow strict\n * @polyfill\n */\n\nlet _inGuard = 0;\n\ntype ErrorHandler = (error: mixed, isFatal: boolean) => void;\ntype Fn<Args, Return> = (...Args) => Return;\n\n/**\n * This is the error handler that is called when we encounter an exception\n * when loading a module. This will report any errors encountered before\n * ExceptionsManager is configured.\n */\nlet _globalHandler: ErrorHandler = function onError(\n  e: mixed,\n  isFatal: boolean,\n) {\n  throw e;\n};\n\n/**\n * The particular require runtime that we are using looks for a global\n * `ErrorUtils` object and if it exists, then it requires modules with the\n * error handler specified via ErrorUtils.setGlobalHandler by calling the\n * require function with applyWithGuard. Since the require module is loaded\n * before any of the modules, this ErrorUtils must be defined (and the handler\n * set) globally before requiring anything.\n */\nconst ErrorUtils = {\n  setGlobalHandler(fun: ErrorHandler): void {\n    _globalHandler = fun;\n  },\n  getGlobalHandler(): ErrorHandler {\n    return _globalHandler;\n  },\n  reportError(error: mixed): void {\n    _globalHandler && _globalHandler(error, false);\n  },\n  reportFatalError(error: mixed): void {\n    // NOTE: This has an untyped call site in Metro.\n    _globalHandler && _globalHandler(error, true);\n  },\n  applyWithGuard<TArgs: $ReadOnlyArray<mixed>, TOut>(\n    fun: Fn<TArgs, TOut>,\n    context?: ?mixed,\n    args?: ?TArgs,\n    // Unused, but some code synced from www sets it to null.\n    unused_onError?: null,\n    // Some callers pass a name here, which we ignore.\n    unused_name?: ?string,\n  ): ?TOut {\n    try {\n      _inGuard++;\n      // $FlowFixMe: TODO T48204745 (1) apply(context, null) is fine. (2) array -> rest array should work\n      return fun.apply(context, args);\n    } catch (e) {\n      ErrorUtils.reportError(e);\n    } finally {\n      _inGuard--;\n    }\n    return null;\n  },\n  applyWithGuardIfNeeded<TArgs: $ReadOnlyArray<mixed>, TOut>(\n    fun: Fn<TArgs, TOut>,\n    context?: ?mixed,\n    args?: ?TArgs,\n  ): ?TOut {\n    if (ErrorUtils.inGuard()) {\n      // $FlowFixMe: TODO T48204745 (1) apply(context, null) is fine. (2) array -> rest array should work\n      return fun.apply(context, args);\n    } else {\n      ErrorUtils.applyWithGuard(fun, context, args);\n    }\n    return null;\n  },\n  inGuard(): boolean {\n    return !!_inGuard;\n  },\n  guard<TArgs: $ReadOnlyArray<mixed>, TOut>(\n    fun: Fn<TArgs, TOut>,\n    name?: ?string,\n    context?: ?mixed,\n  ): ?(...TArgs) => ?TOut {\n    // TODO: (moti) T48204753 Make sure this warning is never hit and remove it - types\n    // should be sufficient.\n    if (typeof fun !== 'function') {\n      console.warn('A function must be passed to ErrorUtils.guard, got ', fun);\n      return null;\n    }\n    const guardName = name ?? fun.name ?? '<generated guard>';\n    function guarded(...args: TArgs): ?TOut {\n      return ErrorUtils.applyWithGuard(\n        fun,\n        context ?? this,\n        args,\n        null,\n        guardName,\n      );\n    }\n\n    return guarded;\n  },\n};\n\nglobal.ErrorUtils = ErrorUtils;\n\nexport type ErrorUtilsT = typeof ErrorUtils;\n"]}